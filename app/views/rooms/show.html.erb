<div class="container">
  <h2>This is the show page for <b><%= @room.name %></b> (<%= @room.code %>)</h2>
  <p>Your name is <%= @player.name %></p>
  <p>There are currently <span id="player-num"></span> players in this room</p>
  <button class="btn btn-primary start-btn">Let's play Bingo!</button>
</div>

<script>
  window.onload = function () {
    dispatcher.bind(<%= @room.id.to_s %>, function(msg) {
      if(msg["type"] == "update") {
        send("join");
        $("#player-num").text(msg["count"])
      } else if (msg["type"] == "start") {
        window.location.href = "<%= bingo_url %>";
      }
    });
    
    send("join");
  };

  window.onbeforeunload = function() {
    send("leave");
  };

  $(".start-btn").click(function() {
    send("start");
  });

  function send(type) {
    msg = {"type": type,
      "player": <%= @player.id %>,
      "room": <%= @room.id %>}
    dispatcher.trigger("room_message", msg)
  }
</script>
